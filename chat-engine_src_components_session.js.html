<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>chat-engine/src/components/session.js - PubNub ChatEngine</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Guides</h3><ul><li data-sidebar="concepts"><a href="tutorial-concepts.html">Concepts</a><ul><li><a href="tutorial-installing.html">Installing</a></li><li><a href="tutorial-initialization.html">Initialization</a></li><li><a href="tutorial-connect.html">Connect</a><ul><li><a href="tutorial-connectToChatEngine.html">Connect to ChatEngine</a></li><li><a href="tutorial-setUserState.html">Set user state</a></li><li><a href="tutorial-updateUserState.html">Update user state</a></li></ul></li><li><a href="tutorial-theuser.html">Users</a><ul><li><a href="tutorial-findAUser.html">Find a user</a></li><li><a href="tutorial-getUserState.html">Get state for online users</a></li><li><a href="tutorial-onlineOfflineEvents.html">Online and offline status</a></li></ul></li><li><a href="tutorial-chatRooms.html">Chat rooms</a><ul><li><a href="tutorial-createChat.html">Create a chat room</a></li><li><a href="tutorial-inviteUserPrivateChat.html">Invite a user to a private chat room</a></li><li><a href="tutorial-showUsers.html">Show users in a chat room</a></li><li><a href="tutorial-leaveChat.html">Leave a chat room</a></li></ul></li><li><a href="tutorial-messages.html">Messages</a><ul><li><a href="tutorial-sendMessages.html">Send messages</a></li><li><a href="tutorial-receiveMessageOnChat.html">Receive messages</a></li><li><a href="tutorial-sendDirectMessage.html">Send a direct message to a user</a></li><li><a href="tutorial-messagesHistory.html">Retrieve past messages</a></li></ul></li><li><a href="tutorial-networkEvents.html">Network events</a><ul><li><a href="tutorial-disconnectFromChatEngine.html">Disconnect from ChatEngine</a></li><li><a href="tutorial-reconnectToChatEngine.html">Reconnect To ChatEngine</a></li></ul></li><li><a href="tutorial-security.html">Security</a><ul><li><a href="tutorial-encryption.html">Encryption</a></li><li><a href="tutorial-authorization.html">Authorization</a></li></ul></li></ul></li><li data-sidebar="advancedConcepts"><a href="tutorial-advancedConcepts.html">Advanced Concepts</a><ul><li><a href="tutorial-pubSubApi.html">Access Publish and Subscribe API</a></li><li><a href="tutorial-advancedSecurity.html">Advanced Security</a><ul><li><a href="tutorial-thirdPartyAuth.html">Setup Third Party Authentication</a></li><li><a href="tutorial-aesEncryptionArchitecture.html">AES Encryption Architecture</a></li></ul></li><li><a href="tutorial-authentication.html">Authentication</a></li><li><a href="tutorial-authenticationGuide.html">Authentication Guide</a></li><li><a href="tutorial-buildAPlugin.html">Build a Plugin</a></li><li><a href="tutorial-connectDeepDive.html">Connect Deep Dive</a><ul><li><a href="tutorial-connectUser.html">Connect User to ChatEngine</a></li><li><a href="tutorial-connectGlobal.html">Connect ChatEngine.Global</a></li><li><a href="tutorial-connectMe.html">Connect ChatEngine.Me</a></li></ul></li><li><a href="tutorial-errors.html">Errors</a></li><li><a href="tutorial-integrateWithPubnubFunctions.html">Integrate with PubNub Functions</a></li><li><a href="tutorial-integrateWithSdks.html">Integrate with Server SDKs</a></li><li><a href="tutorial-namespaces.html">Namespaces</a></li><li><a href="tutorial-pubnubChannelTopology.html">PubNub Channel Topology</a><ul><li><a href="tutorial-globalChannel.html">Global Channel</a></li><li><a href="tutorial-directChannel.html">Direct Channel</a></li><li><a href="tutorial-feedChannel.html">Feed Channel</a></li><li><a href="tutorial-publicChannel.html">Public Channel</a></li><li><a href="tutorial-privateChannel.html">Private Channel</a></li></ul></li><li><a href="tutorial-templating.html">Templating</a></li><li><a href="tutorial-wildcards.html">Wildcards</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#ChatEngineCore">ChatEngineCore</a></li></ul><h3>Plugins</h3><ul><li data-sidebar="chat-engine-emoji"><a href="module-chat-engine-emoji.html">chat-engine-emoji</a><ul><li><a href="Chat.html">Chat</a><ul class='members'></ul><ul class='methods'><li data-type='method'><a href="module-chat-engine-emoji.html#~parseEmoji">parseEmoji()</a></li><li data-type='method'><a href="module-chat-engine-emoji.html#~render">render()</a></li><li data-type='method'><a href="module-chat-engine-emoji.html#~search">search()</a></li></ul></ul></li><li data-sidebar="chat-engine-gravatar"><a href="module-chat-engine-gravatar.html">chat-engine-gravatar</a><ul><li><a href="User.html">User</a><ul class='members'><li data-type='member'><a href="module-chat-engine-gravatar.html#~state%2522.%2522gravatar">state.gravatar</a></li></ul></ul></li><li data-sidebar="chat-engine-markdown"><a href="module-chat-engine-markdown.html">chat-engine-markdown</a></li><li data-sidebar="chat-engine-mute"><a href="module-chat-engine-mute.html">chat-engine-mute</a><ul><li><a href="Chat.html">Chat</a><ul class='members'></ul><ul class='methods'><li data-type='method'><a href="module-chat-engine-mute.html#~muter%2522.%2522isMuted">muter.isMuted()</a></li><li data-type='method'><a href="module-chat-engine-mute.html#~muter%2522.%2522mute">muter.mute()</a></li><li data-type='method'><a href="module-chat-engine-mute.html#~muter%2522.%2522unmute">muter.unmute()</a></li></ul></ul></li><li data-sidebar="chat-engine-online-user-search"><a href="module-chat-engine-online-user-search.html">chat-engine-online-user-search</a><ul><li><a href="Chat.html">Chat</a><ul class='members'></ul><ul class='methods'><li data-type='method'><a href="module-chat-engine-online-user-search.html#~search">search()</a></li></ul></ul></li><li data-sidebar="chat-engine-typing-indicator"><a href="module-chat-engine-typing-indicator.html">chat-engine-typing-indicator</a><ul><li><a href="Chat.html">Chat</a><ul class='members'></ul><ul class='methods'><li data-type='method'><a href="module-chat-engine-typing-indicator.html#~typingindicator%2522.%2522startTyping">typingindicator.startTyping()</a></li><li data-type='method'><a href="module-chat-engine-typing-indicator.html#~typingindicator%2522.%2522stopTyping">typingindicator.stopTyping()</a></li></ul><ul class='events'><li data-type='event'><a href="module-chat-engine-typing-indicator.html#~event:$typingIndiciator%2522.%2522stopTyping">$typingIndiciator.stopTyping</a></li></ul></ul></li><li data-sidebar="chat-engine-unread-messages"><a href="module-chat-engine-unread-messages.html">chat-engine-unread-messages</a><ul><li><a href="Chat.html">Chat</a><ul class='members'><li data-type='member'><a href="module-chat-engine-unread-messages.html#~unreadCount">unreadCount</a></li><li data-type='member'><a href="module-chat-engine-unread-messages.html#~unreadMessages%2522.%2522isActive">unreadMessages.isActive</a></li><li data-type='member'><a href="module-chat-engine-unread-messages.html#~unreadMessages%2522.%2522unreadCount">unreadMessages.unreadCount</a></li></ul><ul class='methods'><li data-type='method'><a href="module-chat-engine-unread-messages.html#~unreadMessages%2522.%2522active">unreadMessages.active()</a></li><li data-type='method'><a href="module-chat-engine-unread-messages.html#~unreadMessages%2522.%2522active">unreadMessages.active()</a></li></ul><ul class='events'><li data-type='event'><a href="module-chat-engine-unread-messages.html#~event:$unread">$unread</a></li></ul></ul></li><li data-sidebar="chat-engine-uploadcare"><a href="module-chat-engine-uploadcare.html">chat-engine-uploadcare</a><ul><li><a href="Chat.html">Chat</a><ul class='members'></ul><ul class='methods'><li data-type='method'><a href="module-chat-engine-uploadcare.html#~uploadcare%2522.%2522bind">uploadcare.bind()</a></li></ul><ul class='events'><li data-type='event'><a href="module-chat-engine-uploadcare.html#~event:$uploadcare%2522.%2522upload">$uploadcare.upload</a></li></ul></ul></li></ul><h3>Reference</h3><ul><li data-sidebar="Chat"><a href="Chat.html">Chat</a><ul class='members'><li data-type='member'><a href="Chat.html#asleep">asleep</a></li><li data-type='member'><a href="Chat.html#channel">channel</a></li><li data-type='member'><a href="Chat.html#connected">connected</a></li><li data-type='member'><a href="Chat.html#hasConnected">hasConnected</a></li><li data-type='member'><a href="Chat.html#isPrivate">isPrivate</a></li><li data-type='member'><a href="Chat.html#meta">meta</a></li><li data-type='member'><a href="Chat.html#users">users</a></li></ul><ul class='methods'><li data-type='method'><a href="Chat.html#connect">connect()</a></li><li data-type='method'><a href="Chat.html#emit">emit()</a></li><li data-type='method'><a href="Chat.html#invite">invite()</a></li><li data-type='method'><a href="Chat.html#leave">leave()</a></li><li data-type='method'><a href="Chat.html#objectify">objectify()</a></li><li data-type='method'><a href="Chat.html#off">off()</a></li><li data-type='method'><a href="Chat.html#on">on()</a></li><li data-type='method'><a href="Chat.html#onAny">onAny()</a></li><li data-type='method'><a href="Chat.html#once">once()</a></li><li data-type='method'><a href="Chat.html#plugin">plugin()</a></li><li data-type='method'><a href="Chat.html#search">search()</a></li><li data-type='method'><a href="Chat.html#update">update()</a></li></ul><ul class='events'><li data-type='event'><a href="Chat.html#event:$%2522.%2522connected">$.connected</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522error%2522.%2522chatLeave">$.error.chatLeave</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522error%2522.%2522chatMeta">$.error.chatMeta</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522error%2522.%2522getState">$.error.getState</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522error%2522.%2522invite">$.error.invite</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522error%2522.%2522notConnected">$.error.notConnected</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522error%2522.%2522presence">$.error.presence</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522error%2522.%2522publish">$.error.publish</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522error%2522.%2522search">$.error.search</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522error%2522.%2522sync">$.error.sync</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522offline%2522.%2522disconnect">$.offline.disconnect</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522offline%2522.%2522leave">$.offline.leave</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522online%2522.%2522here">$.online.here</a></li><li data-type='event'><a href="Chat.html#event:$%2522.%2522online%2522.%2522join">$.online.join</a></li></ul></li><li data-sidebar="ChatEngine"><a href="ChatEngine.html">ChatEngine</a><ul class='members'><li data-type='member'><a href="ChatEngine.html#.Chat">Chat</a></li><li data-type='member'><a href="ChatEngine.html#.chats">chats</a></li><li data-type='member'><a href="ChatEngine.html#.global">global</a></li><li data-type='member'><a href="ChatEngine.html#.me">me</a></li><li data-type='member'><a href="ChatEngine.html#.pubnub">pubnub</a></li><li data-type='member'><a href="ChatEngine.html#.ready">ready</a></li><li data-type='member'><a href="ChatEngine.html#.User">User</a></li><li data-type='member'><a href="ChatEngine.html#.users">users</a></li></ul><ul class='methods'><li data-type='method'><a href="ChatEngine.html#connect">connect()</a></li><li data-type='method'><a href="ChatEngine.html#disconnect">disconnect()</a></li><li data-type='method'><a href="ChatEngine.html#off">off()</a></li><li data-type='method'><a href="ChatEngine.html#on">on()</a></li><li data-type='method'><a href="ChatEngine.html#onAny">onAny()</a></li><li data-type='method'><a href="ChatEngine.html#once">once()</a></li><li data-type='method'><a href="ChatEngine.html#proto">proto()</a></li><li data-type='method'><a href="ChatEngine.html#reauthorize">reauthorize()</a></li><li data-type='method'><a href="ChatEngine.html#reconnect">reconnect()</a></li></ul><ul class='events'><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522created%2522.%2522chat">$.created.chat</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522created%2522.%2522me">$.created.me</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522created%2522.%2522user">$.created.user</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522network%2522.%2522down%2522.%2522badrequest">$.network.down.badrequest</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522network%2522.%2522down%2522.%2522decryption">$.network.down.decryption</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522network%2522.%2522down%2522.%2522denied">$.network.down.denied</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522network%2522.%2522down%2522.%2522issue">$.network.down.issue</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522network%2522.%2522down%2522.%2522malformed">$.network.down.malformed</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522network%2522.%2522down%2522.%2522offline">$.network.down.offline</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522network%2522.%2522down%2522.%2522timeout">$.network.down.timeout</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522network%2522.%2522up%2522.%2522connected">$.network.up.connected</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522network%2522.%2522up%2522.%2522online">$.network.up.online</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522network%2522.%2522up%2522.%2522reconnected">$.network.up.reconnected</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522ready">$.ready</a></li><li data-type='event'><a href="ChatEngine.html#event:$%2522.%2522state">$.state</a></li></ul></li><li data-sidebar="Emitter"><a href="Emitter.html">Emitter</a><ul class='members'></ul><ul class='methods'><li data-type='method'><a href="Emitter.html#off">off()</a></li><li data-type='method'><a href="Emitter.html#on">on()</a></li><li data-type='method'><a href="Emitter.html#onAny">onAny()</a></li><li data-type='method'><a href="Emitter.html#once">once()</a></li><li data-type='method'><a href="Emitter.html#plugin">plugin()</a></li></ul></li><li data-sidebar="Event"><a href="Event.html">Event</a><ul class='members'><li data-type='member'><a href="Event.html#channel">channel</a></li><li data-type='member'><a href="Event.html#chat">chat</a></li><li data-type='member'><a href="Event.html#event">event</a></li><li data-type='member'><a href="Event.html#name">name</a></li></ul><ul class='methods'><li data-type='method'><a href="Event.html#off">off()</a></li><li data-type='method'><a href="Event.html#on">on()</a></li><li data-type='method'><a href="Event.html#onAny">onAny()</a></li><li data-type='method'><a href="Event.html#once">once()</a></li><li data-type='method'><a href="Event.html#plugin">plugin()</a></li></ul><ul class='events'><li data-type='event'><a href="Event.html#event:$%2522.%2522emitted%2522">$.emitted</a></li></ul></li><li data-sidebar="Me"><a href="Me.html">Me</a><ul class='members'><li data-type='member'><a href="Me.html#direct">direct</a></li><li data-type='member'><a href="Me.html#feed">feed</a></li><li data-type='member'><a href="Me.html#session">session</a></li><li data-type='member'><a href="Me.html#state">state</a></li><li data-type='member'><a href="Me.html#uuid">uuid</a></li></ul><ul class='methods'><li data-type='method'><a href="Me.html#off">off()</a></li><li data-type='method'><a href="Me.html#on">on()</a></li><li data-type='method'><a href="Me.html#onAny">onAny()</a></li><li data-type='method'><a href="Me.html#once">once()</a></li><li data-type='method'><a href="Me.html#plugin">plugin()</a></li><li data-type='method'><a href="Me.html#update">update()</a></li></ul><ul class='events'><li data-type='event'><a href="Me.html#event:$%2522.%2522invite">$.invite</a></li></ul></li><li data-sidebar="RootEmitter"><a href="RootEmitter.html">RootEmitter</a><ul class='members'></ul><ul class='methods'><li data-type='method'><a href="RootEmitter.html#off">off()</a></li><li data-type='method'><a href="RootEmitter.html#on">on()</a></li><li data-type='method'><a href="RootEmitter.html#onAny">onAny()</a></li><li data-type='method'><a href="RootEmitter.html#once">once()</a></li></ul></li><li data-sidebar="Search"><a href="Search.html">Search</a><ul class='members'><li data-type='member'><a href="Search.html#chat">chat</a></li><li data-type='member'><a href="Search.html#config">config</a></li><li data-type='member'><a href="Search.html#hasMore">hasMore</a></li></ul><ul class='methods'><li data-type='method'><a href="Search.html#next">next()</a></li><li data-type='method'><a href="Search.html#off">off()</a></li><li data-type='method'><a href="Search.html#on">on()</a></li><li data-type='method'><a href="Search.html#onAny">onAny()</a></li><li data-type='method'><a href="Search.html#once">once()</a></li><li data-type='method'><a href="Search.html#plugin">plugin()</a></li></ul><ul class='events'><li data-type='event'><a href="Search.html#event:$%2522.%2522page%2522.%2522response">$.page.response</a></li><li data-type='event'><a href="Search.html#event:$%2522.%2522search%2522.%2522finish">$.search.finish</a></li><li data-type='event'><a href="Search.html#event:$%2522.%2522search%2522.%2522pause%2522">$.search.pause</a></li><li data-type='event'><a href="Search.html#event:$%2522.%2522search%2522.%2522start">$.search.start</a></li></ul></li><li data-sidebar="Session"><a href="Session.html">Session</a><ul class='members'><li data-type='member'><a href="Session.html#chats">chats</a></li><li data-type='member'><a href="Session.html#sync">sync</a></li></ul><ul class='methods'><li data-type='method'><a href="Session.html#off">off()</a></li><li data-type='method'><a href="Session.html#on">on()</a></li><li data-type='method'><a href="Session.html#onAny">onAny()</a></li><li data-type='method'><a href="Session.html#once">once()</a></li><li data-type='method'><a href="Session.html#plugin">plugin()</a></li></ul><ul class='events'><li data-type='event'><a href="Session.html#event:$%2522.%2522chat%2522.%2522join">$.chat.join</a></li><li data-type='event'><a href="Session.html#event:$%2522.%2522chat%2522.%2522leave">$.chat.leave</a></li><li data-type='event'><a href="Session.html#event:$%2522.%2522group%2522.%2522restored">$.group.restored</a></li></ul></li><li data-sidebar="User"><a href="User.html">User</a><ul class='members'><li data-type='member'><a href="User.html#direct">direct</a></li><li data-type='member'><a href="User.html#feed">feed</a></li><li data-type='member'><a href="User.html#state">state</a></li><li data-type='member'><a href="User.html#uuid">uuid</a></li></ul><ul class='methods'><li data-type='method'><a href="User.html#off">off()</a></li><li data-type='method'><a href="User.html#on">on()</a></li><li data-type='method'><a href="User.html#onAny">onAny()</a></li><li data-type='method'><a href="User.html#once">once()</a></li><li data-type='method'><a href="User.html#plugin">plugin()</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">chat-engine/src/components/session.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Emitter = require('../modules/emitter');

/**
Automatically created by supplying ```enableSync: true``` in ```ChatEngineCore.create```.
Access via {@link Me#session}.

Used to synchronize ChatEngine sessions between desktop and mobile, duplicate windows, etc.
Sessions are the same when identical instance of {@link ChatEngine} and {@link Me} connects to ChatEngine.
Should not be created directly.
@class Session
@extends Emitter
@extends RootEmitter
*/
class Session extends Emitter {

    constructor(chatEngine) {

        super(chatEngine);

        this.name = 'Session';

        this.chatEngine = chatEngine;

        /**
         * Stores a map of {@link Chat} objects that this {@link Me} has joined across all clients.
         * @type {Object}
         */
        this.chats = {};

        /**
         * The {@link Chat} that syncs session between instances.
         * @type {this}
         */
        this.sync = null;

    }

    /**
     * Forwards sync events from other instances into callback functions
     * @private
     */
    subscribe() {

        this.sync = new this.chatEngine.Chat([this.chatEngine.global.channel, 'user', this.chatEngine.me.uuid, 'me.', 'sync'].join('#'), false, this.chatEngine.ceConfig.enableSync, {}, 'system');

        // subscribe to the events on our sync chat and forward them
        this.sync.on('$.session.notify.chat.join', (payload) => {
            this.onJoin(payload.data.subject);
        });

        this.sync.on('$.session.notify.chat.leave', (payload) => {
            this.onleave(payload.data.subject);
        });

    }

    /**
     * Uses PubNub channel groups to restore a session for this uuid
     * @private
     */
    restore() {

        // these are custom groups that separate custom chats from system chats
        // for better fitlering
        let groups = ['custom', 'system'];

        // loop through the groups
        groups.forEach((group) => {

            // generate the channel group string for PubNub using the current uuid
            let channelGroup = [this.chatEngine.ceConfig.globalChannel, this.chatEngine.me.uuid, group].join('#');

            // ask pubnub for a list of channels for this group
            this.chatEngine.pubnub.channelGroups.listChannels({
                channelGroup
            }, (status, response) => {

                if (status.error) {

                    /**
                     * There was a problem restoring the session
                     * @event Chat#$"."error"."sync
                     * @property {String} ceError The specific error thrown by ChatEngine
                     */
                    this.chatEngine.throwError(this.chatEngine, '_emit', 'sync', new Error('There was a problem restoring your session from PubNub servers.'), { status });

                } else {

                    // loop through the returned channels
                    response.channels.forEach((channel) => {

                        // call the same callback as if we were notified about them
                        this.onJoin({
                            channel,
                            private: this.chatEngine.parseChannel(channel).private,
                            group
                        });

                        /**
                        * Fired when session has been restored at boot. Fired once per
                        * session group.
                        * @event Session#$"."group"."restored
                        * @type {object}
                        * @property {string} group The {@link Chat#group} that has been restored.
                        */
                        this.trigger('$.group.restored', { group });

                    });

                }

            });

        });

    }

    /**
     * Callback fired when another instance has joined a chat
     * @private
     */
    join(chat) {

        // don't rebroadcast chats in session we've already heard about
        if (!this.chats[chat.group] || !this.chats[chat.group][chat.channel]) {
            this.sync.emit('$.session.notify.chat.join', { subject: chat.objectify() });
        }

    }

    /**
     * Callback fired when another instance has left a chat
     * @private
     */
    leave(chat) {
        this.sync.emit('$.session.notify.chat.leave', { subject: chat.objectify() });
    }

    /**
    Stores {@link Chat} within ```ChatEngine.session``` keyed based on the ```chat.group``` property.
    @param {Object} chat JSON object representing {@link Chat}. Originally supplied via {@link Chat#objectify}.
    @private
    */
    onJoin(chat) {

        // create the chat group if it doesn't exist
        this.chats[chat.group] = this.chats[chat.group] || {};

        // check the chat exists within the global list but is not grouped
        let existingChat = this.chatEngine.chats[chat.channel];

        // if it exists
        if (existingChat) {

            // assign it to the group
            this.chats[chat.group][chat.channel] = existingChat;
        } else {

            // otherwise, try to recreate it with the server information
            this.chats[chat.group][chat.channel] = new this.chatEngine.Chat(chat.channel, chat.private, false, chat.meta, chat.group);

            /**
            * Fired when another identical instance of {@link ChatEngine} and {@link Me} joins a {@link Chat} that this instance of {@link ChatEngine} is unaware of.
            * Used to synchronize ChatEngine sessions between desktop and mobile, duplicate windows, etc.
            * ChatEngine stores sessions on the server side identified by {@link User#uuid}.
            * @event Session#$"."chat"."join
            * @type {object}
            * @property {Chat} chat The chat added to the user session.
            @example
            *
            * // Logged in as "Ian" in first window
            * ChatEngine.me.session.on('$.chat.join', (data) => {
            *     console.log('I joined a new chat in a second window!', data.chat);
            * });
            *
            * // Logged in as "Ian" in second window
            * new ChatEngine.Chat('another-chat');
            */
            this.trigger('$.chat.join', { chat: this.chats[chat.group][chat.channel] });

        }

    }

    /**
    Removes {@link Chat} within this.chats
    @private
    */
    onleave(chat) {

        if (this.chats[chat.group] &amp;&amp; this.chats[chat.group][chat.channel]) {

            chat = this.chats[chat.group][chat.channel] || chat;

            /**
            * Fired when another identical instance of {@link ChatEngine} with an identical {@link Me} leaves a {@link Chat} via {@link Chat#leave}.
            * @event Session#$"."chat"."leave
            * @type {object}
            * @property {Chat} chat The chat removed from the user session.
            */
            delete this.chatEngine.chats[chat.channel];
            delete this.chats[chat.group][chat.channel];

        }

        this.trigger('$.chat.leave', { chat });

    }

}

module.exports = Session;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.2</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
